<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FoodGalaxy ‚Äì Dream Food Ordering App</title>
<style>
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Poppins', sans-serif;
    background: radial-gradient(circle at top, #ffcf71 0, #f48fb1 28%, #3f51b5 70%, #121212 100%);
    color: #f5f5f5;
    min-height: 100vh;
    transition: background 0.3s ease, color 0.3s ease;
  }

  /* ---------- LIGHT THEME OVERRIDE ---------- */
  body.light-theme {
    background: #f5f5f5;
    color: #222;
  }
  body.light-theme header {
    background: rgba(255,255,255,0.9);
    border-bottom-color: rgba(0,0,0,0.08);
  }
  body.light-theme nav {
    background: rgba(250,250,250,0.95);
    border-bottom-color: rgba(0,0,0,0.1);
  }
  body.light-theme .glass-card,
  body.light-theme .menu-item,
  body.light-theme .cuisine-card {
    background: rgba(255,255,255,0.95);
    border-color: rgba(0,0,0,0.08);
    color: #222;
  }
  body.light-theme table {
    background: rgba(255,255,255,0.95);
  }
  body.light-theme th {
    background: rgba(0,0,0,0.06);
    color: #333;
  }
  body.light-theme footer {
    background: #eeeeee;
    color: #444;
    border-top-color: rgba(0,0,0,0.1);
  }
  body.light-theme .feature-card,
  body.light-theme .order-card {
    background: rgba(255,255,255,0.95);
    border-color: rgba(0,0,0,0.1);
  }
  body.light-theme .home-pill {
    background: rgba(0,0,0,0.05);
    border-color: rgba(0,0,0,0.12);
  }
  body.light-theme .phone-mock {
    background: radial-gradient(circle at top, #e0e0e0 0, #bdbdbd 60%);
    border-color: rgba(0,0,0,0.18);
  }
  body.light-theme .login-card {
    background: rgba(255,255,255,0.96);
    border-color: rgba(0,0,0,0.16);
    color: #222;
  }
  body.light-theme .login-card input {
    background: rgba(0,0,0,0.04);
    border-color: rgba(0,0,0,0.2);
    color: #222;
  }

  header {
    text-align: center;
    padding: 25px 20px;
    background: rgba(10, 10, 10, 0.75);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    border-bottom: 1px solid rgba(255,255,255,0.15);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  header h1 {
    margin: 0;
    font-size: 2.4em;
    color: #ffea00;
    letter-spacing: 1px;
  }
  header p {
    margin: 5px 0 0 0;
    font-size: 0.98em;
    color: #e0e0e0;
  }
  header p span {
    color: #ffeb3b;
    font-weight: 600;
  }

  nav {
    text-align: center;
    background: rgba(18, 18, 18, 0.85);
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.12);
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  nav a {
    color: #f5f5f5;
    margin: 0 4px;
    text-decoration: none;
    font-weight: 500;
    transition: 0.25s;
    cursor: pointer;
    font-size: 0.9rem;
  }
  nav a:hover { 
    color: #ffeb3b; 
    text-shadow: 0 0 6px rgba(255,235,59,0.8);
  }
  nav .nav-meta {
    font-size: 0.8rem;
    color: #ffeb3b;
    margin-left: 8px;
  }
  nav select {
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.3);
    background: rgba(0,0,0,0.5);
    color: #f5f5f5;
    font-size: 0.8rem;
  }
  body.light-theme nav select {
    background: #ffffff;
    color: #222;
    border-color: rgba(0,0,0,0.2);
  }

  .page { 
    display: none; 
    padding: 25px 20px; 
    max-width: 1100px;
    margin: 0 auto;
  }
  .active { display: block; }

  .glass-card {
    background: rgba(18,18,18,0.78);
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.08);
  }

  .menu-grid, .cuisine-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 18px;
  }

  .menu-item, .cuisine-card {
    background: rgba(18,18,18,0.9);
    border-radius: 18px;
    padding: 14px;
    width: 230px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.12);
    transition: transform 0.18s, box-shadow 0.18s, border-color 0.18s;
    position: relative;
  }

  .menu-item:hover, .cuisine-card:hover {
    transform: translateY(-6px) scale(1.02);
    box-shadow: 0 10px 26px rgba(0,0,0,0.85);
    border-color: #ffeb3b;
  }

  .menu-item h3, .cuisine-card h3 {
    margin: 10px 0;
  }

  .category-tag {
    font-size: 0.72rem;
    padding: 3px 10px;
    border-radius: 999px;
    background: linear-gradient(90deg, #ff9800, #ff5252);
    color: #1b1b1b;
    display: inline-block;
    margin-bottom: 6px;
    font-weight: 600;
  }

  .menu-item img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 8px;
  }

  .cuisine-card img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 12px;
    margin: 8px 0;
  }

  .fav-btn {
    position: absolute;
    top: 10px;
    right: 12px;
    background: rgba(0,0,0,0.6);
    color: #ffeb3b;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    border: 1px solid rgba(255,255,255,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    cursor: pointer;
  }
  .fav-btn.active {
    background: #ffeb3b;
    color: #1b1b1b;
  }

  button {
    background: linear-gradient(90deg, #ff9800, #ff5722);
    color: #1b1b1b;
    border: none;
    padding: 8px 16px;
    border-radius: 999px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.25s;
    font-size: 0.9rem;
  }
  button:hover { 
    background: linear-gradient(90deg, #ffeb3b, #ff9800); 
    color: #000;
    box-shadow: 0 0 10px rgba(255,235,59,0.7);
  }

  .ghost-btn {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.35);
    color: #f5f5f5;
  }
  .ghost-btn:hover {
    background: rgba(255,255,255,0.08);
    color: #ffeb3b;
  }
  body.light-theme .ghost-btn {
    border-color: rgba(0,0,0,0.4);
    color: #222;
  }
  body.light-theme .ghost-btn:hover {
    background: rgba(0,0,0,0.06);
    color: #000;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: rgba(18,18,18,0.9);
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.7);
  }
  th, td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    text-align: center;
    font-size: 0.9rem;
  }
  th { 
    color: #ffeb3b; 
    background: rgba(0,0,0,0.7);
  }

  footer {
    background: rgba(0,0,0,0.85);
    color: #bdbdbd;
    padding: 18px;
    text-align: center;
    border-top: 1px solid rgba(255,255,255,0.12);
    margin-top: 40px;
    font-size: 0.85rem;
  }

  @media (max-width: 768px) {
    header h1 { font-size: 2rem; }
    .page { padding: 15px; }
  }

  /* ---------- HOME PAGE EXTRAS ---------- */

  .home-hero {
    display: flex;
    gap: 25px;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 22px;
    flex-wrap: wrap;
  }

  .home-hero-left {
    flex: 1 1 280px;
  }

  .home-hero-right {
    flex: 1 1 260px;
    display: flex;
    justify-content: center;
  }

  .home-pill {
    display: inline-block;
    font-size: 0.8rem;
    padding: 5px 12px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255,255,255,0.18);
    margin-bottom: 10px;
  }

  .brand-accent {
    color: #ffea00;
  }

  .home-hero-left h2 {
    margin: 4px 0 8px;
    font-size: 2rem;
  }

  .home-hero-left p {
    font-size: 0.95rem;
    max-width: 480px;
    color: #e0e0e0;
  }

  .home-cta-row {
    display: flex;
    gap: 10px;
    margin: 15px 0;
    flex-wrap: wrap;
  }

  .home-stats {
    display: flex;
    gap: 20px;
    margin-top: 10px;
    font-size: 0.8rem;
  }
  .home-stats div {
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.1);
    text-align: center;
    min-width: 70px;
  }
  .home-stats strong {
    display: block;
    font-size: 1.1rem;
    color: #ffeb3b;
  }

  .phone-mock {
    width: 260px;
    border-radius: 26px;
    padding: 10px 10px 16px;
    background: radial-gradient(circle at top, #3f51b5 0, #121212 60%);
    box-shadow: 0 18px 40px rgba(0,0,0,0.9);
    border: 1px solid rgba(255,255,255,0.08);
  }

  .phone-header {
    display: flex;
    gap: 6px;
    margin-bottom: 8px;
  }

  .phone-header .dot {
    width: 7px;
    height: 7px;
    border-radius: 999px;
    background: rgba(255,255,255,0.35);
  }

  .phone-body h4 {
    margin: 4px 0 10px;
    font-size: 0.95rem;
  }

  .phone-list {
    list-style: none;
    padding: 0;
    margin: 0 0 12px;
    font-size: 0.8rem;
  }

  .phone-list li {
    display: flex;
    justify-content: space-between;
    padding: 6px 8px;
    margin-bottom: 6px;
    border-radius: 10px;
    background: rgba(0,0,0,0.45);
  }

  .phone-btn {
    width: 100%;
    font-size: 0.85rem;
    padding: 7px 0;
  }

  .home-sections {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }

  .home-sub h3 {
    margin-top: 0;
  }

  .feature-row {
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
    margin-top: 10px;
  }

  .feature-card {
    flex: 1 1 180px;
    padding: 12px;
    border-radius: 14px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.08);
    font-size: 0.85rem;
  }

  .feature-card h4 {
    margin: 0 0 4px;
    font-size: 0.9rem;
    color: #ffeb3b;
  }

  .chip-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }

  .chip {
    padding: 6px 12px;
    border-radius: 999px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.14);
    font-size: 0.8rem;
    cursor: pointer;
    transition: 0.2s;
  }

  .chip:hover {
    border-color: #ffeb3b;
    box-shadow: 0 0 8px rgba(255,235,59,0.6);
  }

  .chip-note {
    margin-top: 6px;
    font-size: 0.75rem;
    color: #cfcfcf;
  }

  @media (max-width: 768px) {
    .home-hero {
      flex-direction: column;
    }
    .home-hero-right {
      order: -1;
    }
  }

  /* ---------- LOGIN SCREEN ---------- */

  #login-screen {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #3f51b5 0, #121212 70%);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9998;
  }

  .login-card {
    background: rgba(0,0,0,0.82);
    padding: 24px 22px;
    border-radius: 18px;
    max-width: 360px;
    width: 90%;
    box-shadow: 0 14px 40px rgba(0,0,0,0.85);
    border: 1px solid rgba(255,255,255,0.16);
    text-align: center;
  }

  .login-card h2 {
    margin-top: 0;
    margin-bottom: 4px;
  }

  .login-card p {
    font-size: 0.85rem;
    color: #d3d3d3;
    margin-top: 0;
    margin-bottom: 14px;
  }

  .login-card label {
    display: block;
    text-align: left;
    font-size: 0.8rem;
    margin: 8px 0 4px;
    color: #f5f5f5;
  }

  .login-card input {
    width: 100%;
    padding: 7px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.6);
    color: #f5f5f5;
    font-size: 0.85rem;
  }

  .login-card input:focus {
    outline: none;
    border-color: #ffeb3b;
    box-shadow: 0 0 8px rgba(255,235,59,0.5);
  }

  .login-card button {
    width: 100%;
    margin-top: 14px;
  }

  /* ---------- SPLASH SCREEN ---------- */

  #splash-screen {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, #ffcf71 0, #f48fb1 28%, #3f51b5 70%, #121212 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    flex-direction: column;
    color: #ffeb3b;
  }
  #splash-logo {
    font-size: 2.5rem;
    margin-bottom: 10px;
  }
  #splash-sub {
    font-size: 0.9rem;
    color: #f5f5f5;
    margin-bottom: 16px;
  }
  .splash-loader {
    width: 120px;
    height: 4px;
    border-radius: 999px;
    background: rgba(0,0,0,0.4);
    overflow: hidden;
  }
  .splash-loader-inner {
    width: 40px;
    height: 100%;
    border-radius: 999px;
    background: #ffeb3b;
    animation: slide 1.2s infinite;
  }
  @keyframes slide {
    0% { transform: translateX(-40px); }
    50% { transform: translateX(80px); }
    100% { transform: translateX(-40px); }
  }

  /* ---------- ORDER SUCCESS ---------- */

  .success-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: 3px solid #4caf50;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: 2rem;
  }

  .order-meta {
    font-size: 0.85rem;
    color: #cfcfcf;
    margin-bottom: 10px;
  }

  .order-items-list {
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: 0.85rem;
  }

  .order-items-list li {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  /* ---------- ORDER HISTORY ---------- */

  .order-card {
    margin-bottom: 12px;
    padding: 12px;
    border-radius: 12px;
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.1);
    font-size: 0.85rem;
  }

  .order-card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
  }

  .order-card-items {
    margin: 6px 0;
  }

  .order-card-items span {
    display: inline-block;
    margin-right: 6px;
  }

  /* ---------- WATERMARK ---------- */

  .watermark {
    position: fixed;
    right: 12px;
    bottom: 12px;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 0.75rem;
    background: rgba(0,0,0,0.65);
    border: 1px solid rgba(255,255,255,0.18);
    color: #f5f5f5;
    backdrop-filter: blur(6px);
    z-index: 999;
  }

  body.light-theme .watermark {
    background: rgba(255,255,255,0.9);
    border-color: rgba(0,0,0,0.12);
    color: #222;
  }

  /* ---------- OFFLINE BANNER ---------- */

  #offline-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: #f44336;
    color: #fff;
    padding: 6px 12px;
    font-size: 0.8rem;
    text-align: center;
    z-index: 10000;
    display: none;
  }

  /* ---------- SEARCH BAR ---------- */

  .search-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
    align-items: center;
  }
  .search-row input {
    flex: 1;
    min-width: 180px;
    padding: 7px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.5);
    color: #f5f5f5;
    font-size: 0.85rem;
  }
  body.light-theme .search-row input {
    background: rgba(0,0,0,0.03);
    border-color: rgba(0,0,0,0.25);
    color: #222;
  }

  /* ---------- PROFILE & ADDRESS ---------- */

  .profile-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
  }
  .profile-col {
    flex: 1 1 260px;
  }
  .profile-col label {
    font-size: 0.8rem;
    display: block;
    margin: 6px 0 2px;
  }
  .profile-col input, .profile-col textarea {
    width: 100%;
    padding: 7px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(0,0,0,0.6);
    color: #f5f5f5;
    font-size: 0.85rem;
  }
  .profile-col textarea {
    min-height: 70px;
    resize: vertical;
  }
  body.light-theme .profile-col input,
  body.light-theme .profile-col textarea {
    background: rgba(0,0,0,0.03);
    border-color: rgba(0,0,0,0.25);
    color: #222;
  }

</style>
</head>
<body>

<div id="offline-banner">You are offline ‚Äî browsing cached data. Some actions may not work.</div>

<!-- SPLASH -->
<div id="splash-screen">
  <div id="splash-logo">üçΩÔ∏è FoodGalaxy</div>
  <div id="splash-sub">Launching your dream food app...</div>
  <div class="splash-loader">
    <div class="splash-loader-inner"></div>
  </div>
</div>

<!-- LOGIN OVERLAY -->
<div id="login-screen">
  <div class="login-card">
    <h2>Welcome to FoodGalaxy</h2>
    <p>Log in to start building your orders.</p>
    <label for="login-name">Name</label>
    <input id="login-name" type="text" placeholder="Enter your name" />

    <label for="login-email">Email (optional)</label>
    <input id="login-email" type="email" placeholder="name@example.com" />

    <button onclick="handleLogin()">Enter the Galaxy</button>
  </div>
</div>

<!-- MAIN APP CONTENT -->
<div id="app-content" style="display:none;">

<header>
  <h1>üçΩÔ∏è FoodGalaxy</h1>
  <p id="header-tagline">
    Order anything, anytime, from anywhere ‚Äî your dream food app.
    <span id="user-greeting"></span>
  </p>
</header>

<nav>
  <a onclick="showPage('home')" id="nav-home">Home</a>
  <a onclick="showPage('menu')" id="nav-menu">Explore Menu</a>
  <a onclick="showPage('cart')" id="nav-cart">Cart üõí (<span id="cart-count">0</span>)</a>
  <a onclick="showPage('favorites')" id="nav-fav">Favorites</a>
  <a onclick="showPage('orders')" id="nav-orders">My Orders</a>
  <a onclick="showPage('calories')" id="nav-calories">Calorie Tracker</a>
  <a onclick="showPage('profile')" id="nav-profile">Profile</a>
  <span class="nav-meta" id="nav-points">Points: <span id="loyalty-points">0</span></span>
  <button class="ghost-btn" style="padding:4px 10px; font-size:0.8rem;" onclick="toggleTheme()">Theme</button>
  <select id="language-select" onchange="changeLanguage(this.value)">
    <option value="en">EN</option>
    <option value="hi">HI</option>
    <option value="ta">TA</option>
  </select>
</nav>
<div id="home" class="page active">
  <div class="glass-card home-hero">
    <div class="home-hero-left">
      <span class="home-pill" id="home-pill-text">Structured Food Ordering Experience</span>
      <h2 id="home-welcome">Welcome to <span class="brand-accent">FoodGalaxy</span></h2>
      <p id="home-desc">
        Browse cuisines like folders, open your selections, and build your cart
        from Indian, Italian, Chinese, Desserts, Beverages & more ‚Äî all in one interface.
      </p>

      <div class="home-cta-row">
        <button onclick="showPage('menu')" id="home-start-btn">Start Ordering</button>
        <button class="ghost-btn" onclick="showPage('menu')" id="home-explore-btn">Explore Cuisines</button>
      </div>

      <div class="home-stats">
        <div>
          <strong>70+</strong>
          <span id="home-stat-dishes">Dishes</span>
        </div>
        <div>
          <strong>9</strong>
          <span id="home-stat-cuisines">Cuisines</span>
        </div>
        <div>
          <strong>‚àû</strong>
          <span id="home-stat-combos">Combinations</span>
        </div>
      </div>
    </div>

    <div class="home-hero-right">
      <div class="phone-mock">
        <div class="phone-header">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
        <div class="phone-body">
          <h4 id="home-tonight">Tonight‚Äôs Picks</h4>
          <ul class="phone-list" id="tonight-list">
            <li>
              <span>Chicken Biryani</span>
              <span>‚Çπ180</span>
            </li>
            <li>
              <span>Peri Peri Fries</span>
              <span>‚Çπ110</span>
            </li>
            <li>
              <span>Bubble Tea</span>
              <span>‚Çπ140</span>
            </li>
          </ul>
          <button onclick="showPage('menu')" class="phone-btn" id="home-build-btn">
            Build Your Order
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="home-sections">
    <div class="home-sub glass-card">
      <h3 id="home-why-title">Key Features</h3>
      <div class="feature-row">
        <div class="feature-card">
          <h4 id="feat1-title">Folder-Style Browsing</h4>
          <p id="feat1-text">Open cuisines like folders and see all dishes grouped.</p>
        </div>
        <div class="feature-card">
          <h4 id="feat2-title">Instant Cart View</h4>
          <p id="feat2-text">Live cart preview with quantity controls and totals.</p>
        </div>
        <div class="feature-card">
          <h4 id="feat3-title">Admin Management</h4>
          <p id="feat3-text">Add new dishes from the Admin panel without reload.</p>
        </div>
      </div>
    </div>

    <div class="home-sub glass-card">
      <h3 id="home-shortcuts-title">Quick Access Shortcuts</h3>
      <div class="chip-row">
        <span class="chip" onclick="jumpToCuisine('Indian')">Indian</span>
        <span class="chip" onclick="jumpToCuisine('Fast Food')">Fast Food</span>
        <span class="chip" onclick="jumpToCuisine('Desserts')">Desserts</span>
        <span class="chip" onclick="jumpToCuisine('Beverages')">Beverages</span>
      </div>
      <p class="chip-note" id="home-shortcuts-note">
        Select a category to open that cuisine directly.
      </p>
    </div>

    <div class="home-sub glass-card">
      <h3>Most Ordered Today</h3>
      <p style="font-size:0.85rem;">Top trending dishes based on your recent orders.</p>
      <div class="menu-grid" id="most-ordered-grid">
        <!-- populated from JS -->
      </div>
    </div>
  </div>
</div>

<div id="menu" class="page">
  <div class="glass-card">
    <h2>Explore Menu</h2>
    <div class="search-row">
      <input id="search-input" type="text"
        placeholder="Search by name, cuisine or try 'veg', 'biryani', 'under 150'..."
        oninput="handleSearchInput()" />
      <button class="ghost-btn" onclick="clearSearch()">Clear</button>
    </div>
    <div id="menu-container"></div>
  </div>
</div>

<div id="cart" class="page">
  <div class="glass-card">
    <h2>Your Cart</h2>
    <table id="cart-table">
      <tr>
        <th>Item</th>
        <th>Price (‚Çπ)</th>
        <th>Quantity</th>
        <th>Total (‚Çπ)</th>
        <th>Actions</th>
      </tr>
    </table>
    <h3 id="cart-total" style="text-align:right;">Total: ‚Çπ0</h3>
    <p id="cart-discount" style="text-align:right; font-size:0.85rem; margin:2px 0;"></p>
    <p id="cart-calories" style="text-align:right; margin-top:4px; font-size:0.85rem; opacity:0.9;">
      Cart Calories (approx): 0 kcal
    </p>
    <div style="margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; justify-content:space-between; align-items:center;">
      <div style="font-size:0.85rem;">
        <label>Promo Code:</label>
        <input id="promo-code" type="text" style="padding:4px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.3); background:rgba(0,0,0,0.5); color:#f5f5f5; font-size:0.8rem;" />
        <button style="padding:5px 10px; font-size:0.8rem;" onclick="applyPromo()">Apply</button>
        <span style="font-size:0.75rem; opacity:0.8; display:block; margin-top:3px;">
          <p style="color: #ffae42; font-weight: 600;">
          Try these promo codes: SHIRLYN (50% OFF), RISHI (10% OFF)
          </p>

        </span>
      </div>
      <div>
        <button onclick="checkout()" style="margin-top:10px;">Checkout</button>
      </div>
    </div>
  </div>
</div>

<!-- FAVORITES PAGE -->
<div id="favorites" class="page">
  <div class="glass-card">
    <h2>Your Favorites</h2>
    <p style="font-size:0.9rem;">Dishes you have marked as favorites.</p>
    <div class="menu-grid" id="favorites-grid"></div>
    <p id="no-favorites-msg" style="font-size:0.85rem; color:#d0d0d0; margin-top:8px;">
      No favorites yet. Tap the star icon on any dish to add it here.
    </p>
  </div>
</div>

<!-- ORDER SUCCESS PAGE -->
<div id="order-success" class="page">
  <div class="glass-card">
    <div class="success-icon">‚úî</div>
    <h2 style="text-align:center;">Order Confirmed</h2>
    <p class="order-meta" id="order-success-meta" style="text-align:center;"></p>
    <ul class="order-items-list" id="order-success-items"></ul>
    <h3 id="order-success-total" style="text-align:right; margin-top:10px;"></h3>
    <p id="order-success-points" style="text-align:right; font-size:0.9rem; margin-top:4px;"></p>
    <p id="order-success-calories" style="text-align:right; font-size:0.9rem; margin-top:2px;"></p>
    <p id="order-success-eta" style="text-align:right; font-size:0.85rem; margin-top:4px; opacity:0.9;"></p>
    <div style="margin-top:15px; display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
      <button onclick="showPage('orders')">View Order History</button>
      <button onclick="showPage('menu')">Order More</button>
      <button class="ghost-btn" onclick="showPage('home')">Back to Home</button>
      <button class="ghost-btn" onclick="printInvoice()">Print Invoice</button>
    </div>
  </div>
</div>

<!-- ORDER HISTORY PAGE -->
<div id="orders" class="page">
  <div class="glass-card">
    <h2>Order History</h2>
    <p id="no-orders-msg" style="font-size:0.9rem; color:#d0d0d0;">
      No orders placed yet. Place an order from the menu to see it here.
    </p>
    <div id="orders-list"></div>
  </div>
</div>

<!-- CALORIE TRACKER PAGE -->
<div id="calories" class="page">
  <div class="glass-card">
    <h2>Calorie Tracker</h2>
    <p style="font-size:0.9rem;">
      Track an approximate calorie count based on your completed orders and current cart.
      Values are approximate for demonstration purposes.
    </p>
    <div style="margin-top:12px;">
      <label style="font-size:0.85rem;">Daily Calorie Target (kcal)</label><br>
      <input id="calorie-target" type="number" value="2200" min="800" max="5000"
        style="padding:6px 8px; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:rgba(0,0,0,0.6); color:#f5f5f5; font-size:0.85rem;"/>
      <button style="margin-left:6px; margin-top:6px;" onclick="updateCalorieTarget()">Update Target</button>
    </div>
    <div style="margin-top:16px; font-size:0.9rem;">
      <p id="calorie-summary"></p>
    </div>
  </div>
</div>

<!-- PROFILE & ADDRESS PAGE -->
<div id="profile" class="page">
  <div class="glass-card">
    <h2>Profile & Delivery Details</h2>
    <div class="profile-grid">
      <div class="profile-col">
        <h3>Profile</h3>
        <label>Name</label>
        <input id="profile-name" type="text" />
        <label>Email</label>
        <input id="profile-email" type="email" />
        <label>Total Orders</label>
        <input id="profile-orders" type="text" disabled />
        <label>Loyalty Points</label>
        <input id="profile-points" type="text" disabled />
        <label>Total Calories from Orders (approx)</label>
        <input id="profile-calories" type="text" disabled />
        <button style="margin-top:10px;" onclick="saveProfile()">Save Profile</button>
      </div>
      <div class="profile-col">
        <h3>Delivery Address</h3>
        <label>Door / Flat No</label>
        <input id="addr-door" type="text" />
        <label>Street</label>
        <input id="addr-street" type="text" />
        <label>City</label>
        <input id="addr-city" type="text" />
        <label>Pincode</label>
        <input id="addr-pin" type="text" />
        <label>Delivery Instructions</label>
        <textarea id="addr-notes"></textarea>
        <button style="margin-top:10px;" onclick="saveAddress()">Save Address</button>
      </div>
    </div>
  </div>
</div>

<footer>
  FoodGalaxy ¬∑ Food Ordering Web Application<br>
  <span style="font-size:0.8rem; opacity:0.8;">
    Designed &amp; developed by <strong>Ms. Shirlyn Danita</strong>
  </span>
</footer>

</div> <!-- end #app-content -->

<!-- FLOATING WATERMARK -->
<div class="watermark">
  Made by <strong>Ms. Shirlyn Danita</strong>
</div>
<script>
  // --------- DATA STRUCTURES ---------

  let menuItems = [];   // ‚úÖ REQUIRED (same variable name as before)

  async function loadMenuFromServer() {
  try {
    const res = await fetch("/api/menu?ts=" + Date.now());
    if (!res.ok) throw new Error("Failed to load menu");
    menuItems = await res.json();
    renderMenu();
    renderMostOrdered();
  } catch (err) {
    console.error(err);
    alert("Unable to load menu from server.");
  }
}

const cuisines = [
  { id: "Indian", title: "Indian", description: "Biryanis, dosas, curries and comfort food.",
    image: "https://static.vecteezy.com/system/resources/thumbnails/034/059/263/small/fresh-and-organic-green-vegetables-for-healthy-eating-and-wellbeing-background-image-photo.jpg"
  },
  { id: "Fast Food", title: "Fast Food", description: "Burgers, fries, fried chicken and more.",
    image: "https://img.freepik.com/free-photo/top-view-fast-food-meal_23-2148273108.jpg"
  },
  { id: "Italian", title: "Italian", description: "Pizzas, pastas, lasagna and garlic bread.",
    image: "https://img.freepik.com/free-photo/top-view-table-full-delicious-food-assortment_23-2149141339.jpg"
  },
  { id: "Chinese", title: "Chinese", description: "Noodles, fried rice, manchurian and more.",
    image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8Y2hpbmVzZSUyMGZvb2R8ZW58MHx8MHx8fDA%3Dj"
  },
  { id: "Japanese", title: "Japanese", description: "Ramen, sushi, tempura and rice bowls.",
    image: "https://img.freepik.com/free-photo/flat-lay-sushi-meal-arrangement_23-2148930393.jpg?semt=ais_hybrid&w=740&q=80"
  },
  { id: "French", title: "French", description: "Bakes, soups and mains.",
    image: "https://img.freepik.com/premium-photo/close-up-food-served-plate-table_1048944-1046596.jpg?semt=ais_hybrid&w=740&q=80"
  },
  { id: "Arabic", title: "Arabic", description: "Shawarma, falafel, hummus and kabsa.",
    image: "https://img.freepik.com/free-photo/falafel-hummus-pita-middle-eastern-arabic-dishes-halal-food-top-view-copy-space_2829-14258.jpg"
  },
  { id: "Desserts", title: "Desserts", description: "Sweet dishes from multiple cuisines.",
    image: "https://plus.unsplash.com/premium_photo-1667546202654-e7574a20872c?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8ZGVzc2VydHN8ZW58MHx8MHx8fDA%3D"
  },
  { id: "Beverages", title: "Beverages", description: "Hot and cold drinks to match every meal.",
    image: "https://img.freepik.com/premium-photo/three-colorful-drinks-are-displayed-with-ice-mint-leaves-slices-lemon-accompanied-by-fresh_667565-6391.jpg?semt=ais_hybrid&w=740&q=80"
  }
];




  let currentCuisine = null;
  let cart = [];
  let orderHistory = [];
  let lastOrder = null;
  let currentUser = null;
  let loyaltyPoints = 0;
  let totalCaloriesConsumed = 0;
  let dailyCalorieTarget = 2200;
  let favorites = new Set();
  let orderCountPerDish = {};
  let currentPromo = null;
  let currentDiscountAmount = 0;
  let reviewsByDishId = {}; // { dishId: [{rating, comment}] }

  // --------- SPLASH & LOGIN FLOW ---------

  window.addEventListener('load', () => {
    // show splash, then login
    setTimeout(() => {
      document.getElementById('splash-screen').style.display = 'none';
      document.getElementById('login-screen').style.display = 'flex';
    }, 1700);
  });

  function handleLogin() {
    const nameInput = document.getElementById('login-name');
    const emailInput = document.getElementById('login-email');
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    if (!name) {
      alert("Please enter your name to continue.");
      return;
    }
    currentUser = { name, email };

    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app-content').style.display = 'block';

    const greetingEl = document.getElementById('user-greeting');
    greetingEl.textContent = `¬∑ User: ${name}`;

    loadProfileFromUser();
    loadAddressFromStorage();
    showPage('home');
  }

  // --------- PAGE NAVIGATION ---------

  function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const page = document.getElementById(pageId);
    if (page) page.classList.add('active');

    if (pageId === 'menu')      renderMenu();
    else if (pageId === 'orders')   renderOrders();
    else if (pageId === 'order-success' && lastOrder) renderOrderSuccess();
    else if (pageId === 'calories') renderCalories();
    else if (pageId === 'favorites') renderFavorites();
    else if (pageId === 'profile')   renderProfileStats();
  }

  function jumpToCuisine(cuisineId) {
    currentCuisine = cuisineId;
    showPage('menu');
  }

  // --------- MENU / SEARCH / FAVORITES ---------

  let activeSearchTerm = "";

  function handleSearchInput() {
    activeSearchTerm = document.getElementById('search-input').value.trim().toLowerCase();
    renderMenu();
  }

  function clearSearch() {
    activeSearchTerm = "";
    document.getElementById('search-input').value = "";
    renderMenu();
  }

  function renderMenu() {
    const container = document.getElementById('menu-container');
    if (!activeSearchTerm && currentCuisine === null) {
      renderCuisineList();
      return;
    }

    // search view (across all or within selected cuisine)
    const results = menuItems.filter(item => {
      if (currentCuisine && item.category !== currentCuisine) return false;
      if (!activeSearchTerm) return true;

      let match = item.name.toLowerCase().includes(activeSearchTerm)
                || item.category.toLowerCase().includes(activeSearchTerm);

      if (activeSearchTerm.includes("veg")) {
        if (/chicken|mutton|fish|beef|egg|shawarma|pepperoni/i.test(item.name)) {
          // non-veg
        } else {
          match = match || true;
        }
      }

      const priceMatch = activeSearchTerm.match(/under\s+(\d+)/);
      if (priceMatch) {
        const limit = Number(priceMatch[1]);
        if (item.price <= limit) match = true;
        else match = false;
      }

      return match;
    });

    let title = "All Dishes";
    if (currentCuisine) title = currentCuisine + " Dishes";

    container.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; flex-wrap:wrap; gap:8px;">
        <div>
          <h3 style="margin:0;">${title}</h3>
          <p style="font-size:0.85rem; margin:2px 0;">
            ${activeSearchTerm ? ("Search results for: " + activeSearchTerm) : "Browse available dishes."}
          </p>
        </div>
        <div>
          ${currentCuisine ? `<button class="ghost-btn" onclick="backToCuisines()">Back to Cuisines</button>` : ``}
        </div>
      </div>
      <div class="menu-grid" id="dish-grid"></div>
    `;

    const grid = document.getElementById('dish-grid');
    grid.innerHTML = '';

    if (!results.length) {
      grid.innerHTML = `<p style="font-size:0.9rem;">No dishes match your search.</p>`;
      return;
    }

    results.forEach(item => {
      const isFav = favorites.has(item.id);
      const dishReviews = reviewsByDishId[item.id] || [];
      let avgRating = 0;
      if (dishReviews.length) {
        avgRating = dishReviews.reduce((s, r) => s + r.rating, 0) / dishReviews.length;
      }

      grid.innerHTML += `
        <div class="menu-item">
          <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite(${item.id}); event.stopPropagation();">
            ${isFav ? '‚òÖ' : '‚òÜ'}
          </button>
          <span class="category-tag">${item.category}</span>
          ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ``}
          <h3>${item.name}</h3>
          <p>‚Çπ${item.price}</p>
          <p style="font-size:0.8rem; opacity:0.9;">Approx: ${item.calories} kcal</p>
          ${dishReviews.length ? `<p style="font-size:0.8rem;">Rating: ${avgRating.toFixed(1)}/5 (${dishReviews.length})</p>` : `<p style="font-size:0.8rem; opacity:0.7;">No ratings yet</p>`}
          <button onclick="addToCart(${item.id})">Add to Cart</button>
        </div>
      `;
    });
  }

  function renderCuisineList() {
    const container = document.getElementById('menu-container');
    container.innerHTML = `
      <p style="text-align:center; margin-bottom:10px;">
        Choose a cuisine to open its dishes.
      </p>
      <div class="cuisine-grid" id="cuisine-grid"></div>
    `;

    const grid = document.getElementById('cuisine-grid');
    grid.innerHTML = '';

    cuisines.forEach(c => {
      grid.innerHTML += `
        <div class="cuisine-card" onclick="openCuisine('${c.id}')">
          <span class="category-tag">${c.id}</span>
          ${c.image ? `<img src="${c.image}" alt="${c.title}">` : ``}
          <h3>${c.title}</h3>
          <p style="font-size:0.85rem; color:#e0e0e0; margin-top:6px;">
            ${c.description}
          </p>
        </div>
      `;
    });
  }

  function openCuisine(id) {
    currentCuisine = id;
    renderMenu();
  }

  function backToCuisines() {
    currentCuisine = null;
    renderMenu();
  }

  function toggleFavorite(itemId) {
    if (favorites.has(itemId)) favorites.delete(itemId);
    else favorites.add(itemId);
    renderMenu();
    renderFavorites();
  }

  function renderFavorites() {
    const grid = document.getElementById('favorites-grid');
    const msg = document.getElementById('no-favorites-msg');
    grid.innerHTML = '';

    const favItems = menuItems.filter(m => favorites.has(m.id));
    if (!favItems.length) {
      msg.style.display = 'block';
      return;
    }
    msg.style.display = 'none';

    favItems.forEach(item => {
      const dishReviews = reviewsByDishId[item.id] || [];
      let avgRating = 0;
      if (dishReviews.length) {
        avgRating = dishReviews.reduce((s, r) => s + r.rating, 0) / dishReviews.length;
      }

      grid.innerHTML += `
        <div class="menu-item">
          <button class="fav-btn active" onclick="toggleFavorite(${item.id}); event.stopPropagation();">
            ‚òÖ
          </button>
          <span class="category-tag">${item.category}</span>
          ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ``}
          <h3>${item.name}</h3>
          <p>‚Çπ${item.price}</p>
          <p style="font-size:0.8rem; opacity:0.9;">Approx: ${item.calories} kcal</p>
          ${dishReviews.length ? `<p style="font-size:0.8rem;">Rating: ${avgRating.toFixed(1)}/5 (${dishReviews.length})</p>` : `<p style="font-size:0.8rem; opacity:0.7;">No ratings yet</p>`}
          <button onclick="addToCart(${item.id})">Add to Cart</button>
        </div>
      `;
    });
  }

  // --------- CART & PROMO ---------

  function addToCart(itemId) {
    const item = menuItems.find(m => m.id === itemId);
    if (!item) return;
    const existing = cart.find(c => c.id === itemId);
    if (existing) existing.qty++;
    else {
      cart.push({
        id: item.id,
        name: item.name,
        price: item.price,
        qty: 1,
        calories: item.calories || 0
      });
    }
    updateCart();
    alert(item.name + " added to cart.");
  }

  function changeQty(itemId, delta) {
    const item = cart.find(c => c.id === itemId);
    if (!item) return;
    item.qty += delta;
    if (item.qty <= 0) cart = cart.filter(c => c.id !== itemId);
    updateCart();
  }

  function removeFromCart(itemId) {
    cart = cart.filter(c => c.id !== itemId);
    updateCart();
  }

  function getCartCalories() {
    return cart.reduce((sum, c) => sum + (c.calories || 0) * c.qty, 0);
  }

  function applyPromo() {
    const code = document.getElementById('promo-code').value.trim().toUpperCase();

    if (!code) {
        alert("Enter a promo code.");
        return;
    }

    const total = cart.reduce((s, c) => s + c.price * c.qty, 0);
    let discount = 0;

    if (code === "RISHI") {
        discount = total * 0.50;   // 50% OFF
    } else if (code === "SHIRLYN") {
        discount = total * 0.10;   // 10% OFF
    } else {
        alert("Invalid promo code.");
        currentPromo = null;
        currentDiscountAmount = 0;
        updateCart();
        return;
    }

    currentPromo = code;
    currentDiscountAmount = Math.round(discount);
    updateCart();
    alert("Promo applied: " + code);
  }


  function updateCart() {
    document.getElementById('cart-count').innerText =
      cart.reduce((sum, c) => sum + c.qty, 0);

    const table = document.getElementById('cart-table');
    table.innerHTML = `
      <tr>
        <th>Item</th>
        <th>Price (‚Çπ)</th>
        <th>Quantity</th>
        <th>Total (‚Çπ)</th>
        <th>Actions</th>
      </tr>
    `;

    let total = 0;
    cart.forEach(c => {
      const lineTotal = c.price * c.qty;
      total += lineTotal;
      table.innerHTML += `
        <tr>
          <td>${c.name}</td>
          <td>${c.price}</td>
          <td>${c.qty}</td>
          <td>${lineTotal}</td>
          <td>
            <button onclick="changeQty(${c.id}, -1)">-</button>
            <button onclick="changeQty(${c.id}, 1)">+</button>
            <button onclick="removeFromCart(${c.id})">Remove</button>
          </td>
        </tr>
      `;
    });

    let discountText = "";
    let finalTotal = total;
    if (currentPromo && currentDiscountAmount > 0) {
      finalTotal = Math.max(0, total - currentDiscountAmount);
      discountText = `Promo (${currentPromo}) applied: -‚Çπ${currentDiscountAmount}. Payable: ‚Çπ${finalTotal}`;
    }

    document.getElementById('cart-total').innerText = "Subtotal: ‚Çπ" + total;
    document.getElementById('cart-discount').innerText = discountText;

    const cartCalories = getCartCalories();
    document.getElementById('cart-calories').innerText =
      "Cart Calories (approx): " + cartCalories + " kcal";

    renderCalories();
  }

  function checkout() {
    if (cart.length === 0) {
      alert("Your cart is empty.");
      return;
    }

    const subtotal = cart.reduce((sum, c) => sum + c.price * c.qty, 0);
    const totalCaloriesOrder = getCartCalories();

    let payable = subtotal;
    if (currentPromo && currentDiscountAmount > 0) {
      payable = Math.max(0, subtotal - currentDiscountAmount);
    }

    const earnedPoints = Math.round(payable / 10);

    const orderId = "FG" + Date.now().toString().slice(-6);
    const time = new Date().toLocaleString();

    const order = {
      id: orderId,
      items: cart.map(c => ({ ...c })),
      subtotal,
      payable,
      time,
      calories: totalCaloriesOrder,
      points: earnedPoints,
      promo: currentPromo || null
    };

    orderHistory.unshift(order);
    lastOrder = order;

    loyaltyPoints += earnedPoints;
    totalCaloriesConsumed += totalCaloriesOrder;
    updateLoyaltyUI();

    // update most ordered count
    order.items.forEach(i => {
      orderCountPerDish[i.id] = (orderCountPerDish[i.id] || 0) + i.qty;
    });

    // clear cart + promo
    cart = [];
    currentPromo = null;
    currentDiscountAmount = 0;
    document.getElementById('promo-code').value = '';
    updateCart();

    showPage('order-success');
  }

  // --------- ORDER SUCCESS / ETA / INVOICE ---------

  function renderOrderSuccess() {
    if (!lastOrder) return;
    const metaEl = document.getElementById('order-success-meta');
    const itemsEl = document.getElementById('order-success-items');
    const totalEl = document.getElementById('order-success-total');
    const pointsEl = document.getElementById('order-success-points');
    const caloriesEl = document.getElementById('order-success-calories');
    const etaEl = document.getElementById('order-success-eta');

    metaEl.textContent = `Order ID: ${lastOrder.id} ¬∑ Placed at ${lastOrder.time}`;
    itemsEl.innerHTML = '';
    lastOrder.items.forEach(item => {
      itemsEl.innerHTML += `
        <li>
          <span>${item.name} x ${item.qty}</span>
          <span>‚Çπ${item.price * item.qty}</span>
        </li>
      `;
    });

    totalEl.textContent = "Amount Paid: ‚Çπ" + lastOrder.payable +
      (lastOrder.promo ? ` (Promo: ${lastOrder.promo})` : "");
    pointsEl.textContent = "Points earned: " + (lastOrder.points || 0) +
      " ¬∑ Total points: " + loyaltyPoints;
    caloriesEl.textContent = "Calories for this order (approx): " +
      (lastOrder.calories || 0) + " kcal";

    // ETA animation
    const stages = [
      "Preparing your food...",
      "Packing your order...",
      "Partner has picked up your order.",
      "Your order is on the way...",
      "Almost there!"
    ];
    let idx = 0;
    etaEl.textContent = stages[0];
    const interval = setInterval(() => {
      idx++;
      if (idx >= stages.length) {
        clearInterval(interval);
        etaEl.textContent = "Estimated delivery in 25‚Äì35 minutes.";
      } else {
        etaEl.textContent = stages[idx];
      }
    }, 2500);

    renderCalories();
    renderMostOrdered();
  }

  function printInvoice() {
    window.print();
  }

  // --------- ORDER HISTORY & REVIEWS ---------

  function renderOrders() {
    const noOrdersMsg = document.getElementById('no-orders-msg');
    const list = document.getElementById('orders-list');

    if (!orderHistory.length) {
      noOrdersMsg.style.display = 'block';
      list.innerHTML = '';
      return;
    }

    noOrdersMsg.style.display = 'none';
    list.innerHTML = '';

    orderHistory.forEach((order, index) => {
      let itemsText = order.items.map(i => `${i.name} x${i.qty}`).join(', ');
      list.innerHTML += `
        <div class="order-card">
          <div class="order-card-header">
            <span><strong>${order.id}</strong></span>
            <span>${order.time}</span>
          </div>
          <div class="order-card-items">
            <strong>Items:</strong>
            <span>${itemsText}</span>
          </div>
          <div style="text-align:right; margin-top:4px;">
            <strong>Subtotal: ‚Çπ${order.subtotal}</strong><br>
            <span>Promo: ${order.promo || 'None'}</span><br>
            <span>Paid: ‚Çπ${order.payable}</span><br>
            <span>Points earned: ${order.points || 0}</span><br>
            <span>Calories (approx): ${order.calories || 0} kcal</span>
          </div>
          <div style="margin-top:6px; text-align:right;">
            <button class="ghost-btn" style="font-size:0.8rem; padding:4px 10px;" onclick="rateOrder(${index})">
              Rate this order
            </button>
          </div>
        </div>
      `;
    });
  }

  function rateOrder(orderIndex) {
    const order = orderHistory[orderIndex];
    if (!order) return;
    const ratingStr = prompt("Rate this order (1-5):");
    const rating = Number(ratingStr);
    if (!rating || rating < 1 || rating > 5) {
      alert("Invalid rating.");
      return;
    }
    const comment = prompt("Leave a short comment (optional):") || "";

    order.items.forEach(i => {
      if (!reviewsByDishId[i.id]) reviewsByDishId[i.id] = [];
      reviewsByDishId[i.id].push({
        rating,
        comment
      });
    });

    alert("Thanks for your feedback.");
    renderMenu();
    renderFavorites();
  }

  // --------- CALORIE TRACKER ---------

  function updateCalorieTarget() {
    const input = document.getElementById('calorie-target');
    const val = Number(input.value);
    if (!val || val < 800) {
      alert("Please enter a realistic target (minimum 800 kcal).");
      return;
    }
    dailyCalorieTarget = val;
    renderCalories();
  }

  function renderCalories() {
    const summaryEl = document.getElementById('calorie-summary');
    if (!summaryEl) return;

    const cartCalories = getCartCalories();
    const totalApprox = totalCaloriesConsumed + cartCalories;

    let msg = `Calories from completed orders: ${totalCaloriesConsumed} kcal. `;
    msg += `Current cart: ${cartCalories} kcal. `;
    msg += `Combined approximate intake: ${totalApprox} / ${dailyCalorieTarget} kcal. `;

    const diff = dailyCalorieTarget - totalApprox;
    if (diff > 0) {
      msg += `Approx. remaining to reach target: ${diff} kcal.`;
    } else if (diff < 0) {
      msg += `Approx. over target: ${Math.abs(diff)} kcal.`;
    } else {
      msg += `You are exactly at your target.`;
    }

    summaryEl.textContent = msg;
  }

  // --------- ADMIN ---------

  function addMenuItemFromAdmin() {
    const nameInput = document.getElementById('admin-name');
    const priceInput = document.getElementById('admin-price');
    const categoryInput = document.getElementById('admin-category');
    const imageInput = document.getElementById('admin-image');
    const calInput = document.getElementById('admin-calories');

    const name = nameInput.value.trim();
    const price = Number(priceInput.value);
    const category = categoryInput.value;
    const image = imageInput.value.trim();
    const calories = Number(calInput.value) || 0;

    if (!name || !price) {
      alert("Please enter both name and price.");
      return;
    }

    const newId = Date.now();
    menuItems.push({
      id: newId,
      name,
      category,
      price,
      calories,
      image: image || ""
    });

    nameInput.value = '';
    priceInput.value = '';
    categoryInput.value = 'Indian';
    imageInput.value = '';
    calInput.value = '';

    renderMenu();
    alert("Dish added: " + name);
  }

  // --------- LOYALTY / MOST ORDERED ---------

  function updateLoyaltyUI() {
    const el = document.getElementById('loyalty-points');
    if (el) el.textContent = loyaltyPoints;
    const navPoints = document.getElementById('nav-points');
    if (navPoints) navPoints.style.display = 'inline-block';
  }

  function renderMostOrdered() {
    const grid = document.getElementById('most-ordered-grid');
    if (!grid) return;

    grid.innerHTML = '';
    const entries = Object.entries(orderCountPerDish);
    if (!entries.length) {
      grid.innerHTML = `<p style="font-size:0.85rem;">No data yet. Place some orders to see trends.</p>`;
      return;
    }

    const top = entries.sort((a,b)=>b[1]-a[1]).slice(0,4);
    top.forEach(([dishId,count])=>{
      const dish = menuItems.find(m=>m.id == dishId);
      if (!dish) return;
      grid.innerHTML += `
        <div class="menu-item">
          <span class="category-tag">${dish.category}</span>
          ${dish.image ? `<img src="${dish.image}" alt="${dish.name}">` : ``}
          <h3>${dish.name}</h3>
          <p>Ordered ${count} time(s)</p>
          <p>‚Çπ${dish.price}</p>
          <button onclick="addToCart(${dish.id})">Reorder</button>
        </div>
      `;
    });
  }

  // --------- PROFILE & ADDRESS ---------

  function loadProfileFromUser() {
    if (!currentUser) return;
    const nameEl = document.getElementById('profile-name');
    const emailEl = document.getElementById('profile-email');
    nameEl.value = currentUser.name;
    emailEl.value = currentUser.email || '';
  }

  function saveProfile() {
    const nameEl = document.getElementById('profile-name');
    const emailEl = document.getElementById('profile-email');
    currentUser.name = nameEl.value.trim();
    currentUser.email = emailEl.value.trim();
    document.getElementById('user-greeting').textContent = '¬∑ User: ' + currentUser.name;
    alert("Profile updated.");
  }

  function saveAddress() {
    const addr = {
      door: document.getElementById('addr-door').value.trim(),
      street: document.getElementById('addr-street').value.trim(),
      city: document.getElementById('addr-city').value.trim(),
      pin: document.getElementById('addr-pin').value.trim(),
      notes: document.getElementById('addr-notes').value.trim()
    };
    localStorage.setItem('foodgalaxy_address', JSON.stringify(addr));
    alert("Address saved.");
  }

  function loadAddressFromStorage() {
    const stored = localStorage.getItem('foodgalaxy_address');
    if (!stored) return;
    try {
      const addr = JSON.parse(stored);
      document.getElementById('addr-door').value = addr.door || '';
      document.getElementById('addr-street').value = addr.street || '';
      document.getElementById('addr-city').value = addr.city || '';
      document.getElementById('addr-pin').value = addr.pin || '';
      document.getElementById('addr-notes').value = addr.notes || '';
    } catch(e) {}
  }

  function renderProfileStats() {
    if (!currentUser) return;
    document.getElementById('profile-orders').value = orderHistory.length;
    document.getElementById('profile-points').value = loyaltyPoints;
    document.getElementById('profile-calories').value = totalCaloriesConsumed + " kcal";
  }

  // --------- THEME TOGGLE ---------

  function toggleTheme() {
    document.body.classList.toggle('light-theme');
  }

  // --------- OFFLINE HANDLING ---------

  window.addEventListener('offline', () => {
    document.getElementById('offline-banner').style.display = 'block';
  });
  window.addEventListener('online', () => {
    document.getElementById('offline-banner').style.display = 'none';
  });

  // --------- LANGUAGE (BASIC TEXT STRINGS) ---------

  const translations = {
    en: {
      headerTagline: "Order anything, anytime, from anywhere ‚Äî your dream food app.",
      homePill: "Structured Food Ordering Experience",
      homeWelcome: "Welcome to FoodGalaxy",
      homeDesc: "Browse cuisines like folders, open your selections, and build your cart from Indian, Italian, Chinese, Desserts, Beverages & more ‚Äî all in one interface.",
      start: "Start Ordering",
      explore: "Explore Cuisines",
      keyFeatures: "Key Features",
      shortcuts: "Quick Access Shortcuts",
      shortcutsNote: "Select a category to open that cuisine directly.",
      feat1Title: "Folder-Style Browsing",
      feat1Text: "Open cuisines like folders and see all dishes grouped.",
      feat2Title: "Instant Cart View",
      feat2Text: "Live cart preview with quantity controls and totals.",
      feat3Title: "Admin Management",
      feat3Text: "Add new dishes from the Admin panel without reload."
    },
    hi: {
      headerTagline: "‡§ï‡§π‡•Ä‡§Ç ‡§∏‡•á ‡§≠‡•Ä, ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‚Äì ‡§Ö‡§™‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ ‡§≠‡•ã‡§ú‡§® ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
      homePill: "‡§∏‡§Ç‡§∞‡§ö‡§ø‡§§ ‡§´‡•Ç‡§° ‡§ë‡§∞‡•ç‡§°‡§∞‡§ø‡§Ç‡§ó ‡§Ö‡§®‡•Å‡§≠‡§µ",
      homeWelcome: "‡§´‡•Ç‡§°‡§ó‡•à‡§≤‡•á‡§ï‡•ç‡§∏‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à",
      homeDesc: "‡§ï‡•ç‡§Ø‡•Ç‡§ú‡§º‡•Ä‡§® ‡§ï‡•ã ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§ñ‡•ã‡§≤‡•á‡§Ç, ‡§Ö‡§™‡§®‡•Ä ‡§™‡§∏‡§Ç‡§¶ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§î‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø, ‡§á‡§ü‡•à‡§≤‡§ø‡§Ø‡§®, ‡§ö‡§æ‡§á‡§®‡•Ä‡§ú‡§º, ‡§°‡•á‡§ú‡§º‡§∞‡•ç‡§ü ‡§µ ‡§°‡•ç‡§∞‡§ø‡§Ç‡§ï‡•ç‡§∏ ‡§è‡§ï ‡§π‡•Ä ‡§ê‡§™ ‡§∏‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§",
      start: "‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
      explore: "‡§ï‡•ç‡§Ø‡•Ç‡§ú‡§º‡•Ä‡§® ‡§¶‡•á‡§ñ‡•á‡§Ç",
      keyFeatures: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Å",
      shortcuts: "‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§™‡§π‡•Å‡§Å‡§ö ‡§∂‡•â‡§∞‡•ç‡§ü‡§ï‡§ü",
      shortcutsNote: "‡§∏‡•Ä‡§ß‡•á ‡§ñ‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡•ç‡§Ø‡•Ç‡§ú‡§º‡•Ä‡§® ‡§ö‡•Å‡§®‡•á‡§Ç‡•§",
      feat1Title: "‡§´‡•ã‡§≤‡•ç‡§°‡§∞-‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§ø‡§Ç‡§ó",
      feat1Text: "‡§ï‡•ç‡§Ø‡•Ç‡§ú‡§º‡•Ä‡§® ‡§ï‡•ã ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§ñ‡•ã‡§≤‡•á‡§Ç ‡§î‡§∞ ‡§°‡§ø‡§∂‡•á‡§ú‡§º ‡§ï‡•ã ‡§∏‡§æ‡§• ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
      feat2Title: "‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§¶‡•É‡§∂‡•ç‡§Ø",
      feat2Text: "‡§ï‡•ç‡§µ‡§æ‡§Ç‡§ü‡§ø‡§ü‡•Ä ‡§î‡§∞ ‡§ü‡•ã‡§ü‡§≤ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡§æ‡§∞‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§",
      feat3Title: "‡§è‡§°‡§Æ‡§ø‡§® ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü",
      feat3Text: "‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§∏‡•á ‡§¨‡§ø‡§®‡§æ ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§ø‡§è ‡§®‡§à ‡§°‡§ø‡§∂ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§"
    },
    ta: {
      headerTagline: "‡Æé‡Æô‡Øç‡Æï‡ØÅ ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç, ‡Æé‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Ææ‡Æ©‡Ææ‡Æ≤‡ØÅ‡ÆÆ‡Øç ‚Äì ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æø‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ÆÆ‡Ææ‡Æ© ‡Æâ‡Æ£‡Æµ‡Øà ‡ÆÜ‡Æ∞‡Øç‡Æü‡Æ∞‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
      homePill: "‡Æí‡Æ¥‡ØÅ‡Æô‡Øç‡Æï‡ØÅ‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æâ‡Æ£‡Æµ‡ØÅ ‡ÆÜ‡Æ∞‡Øç‡Æü‡Æ∞‡Øç ‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Æµ‡ÆÆ‡Øç",
      homeWelcome: "FoodGalaxy-‡Æï‡Øç‡Æï‡ØÅ ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç",
      homeDesc: "‡Æï‡ØÅ‡ÆØ‡Æø‡Æö‡ØÄ‡Æ©‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡Øà‡ÆØ‡Ææ‡Æï ‡Æ§‡Æø‡Æ±‡Æ®‡Øç‡Æ§‡ØÅ, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ™‡Øç ‡Æ™‡Æø‡Æü‡Æø‡Æ§‡Øç‡Æ§ ‡Æâ‡Æ£‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ, ‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ, ‡Æá‡Æ§‡Øç‡Æ§‡Ææ‡Æ≤‡Æø‡ÆØ, ‡Æö‡ØÄ‡Æ©, ‡Æá‡Æ©‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ©‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æí‡Æ∞‡Øá ‡Æá‡Æü‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡ÆÜ‡Æ∞‡Øç‡Æü‡Æ∞‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
      start: "‡ÆÜ‡Æ∞‡Øç‡Æü‡Æ∞‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
      explore: "‡Æï‡ØÅ‡ÆØ‡Æø‡Æö‡ØÄ‡Æ©‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï",
      keyFeatures: "‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Æø‡ÆØ ‡ÆÖ‡ÆÆ‡Øç‡Æö‡Æô‡Øç‡Æï‡Æ≥‡Øç",
      shortcuts: "‡Æµ‡Æø‡Æ∞‡Øà‡Æµ‡Ææ‡Æ© ‡Æï‡ØÅ‡Æ±‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æµ‡Æ¥‡Æø‡Æï‡Æ≥‡Øç",
      shortcutsNote: "‡Æ®‡Øá‡Æ∞‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æ§‡Æø‡Æ±‡Æï‡Øç‡Æï ‡Æí‡Æ∞‡ØÅ ‡Æï‡ØÅ‡ÆØ‡Æø‡Æö‡ØÄ‡Æ©‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.",
      feat1Title: "‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡Øà-‡Æ™‡Ææ‡Æ£‡Æø ‡Æâ‡Æ≤‡Ææ‡Æµ‡Æ≤‡Øç",
      feat1Text: "‡Æï‡ØÅ‡ÆØ‡Æø‡Æö‡ØÄ‡Æ©‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡Øà‡ÆØ‡Ææ‡Æï ‡Æ§‡Æø‡Æ±‡Æ®‡Øç‡Æ§‡ØÅ ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æâ‡Æ£‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà‡ÆØ‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.",
      feat2Title: "‡Æâ‡Æü‡Æ©‡Æü‡Æø ‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æö‡Æø",
      feat2Text: "‡ÆÖ‡Æ≥‡Æµ‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§‡Æ§‡Øç‡Æ§‡ØÅ‡Æü‡Æ©‡Øç ‡Æâ‡Æü‡Æ©‡Æü‡Æø‡ÆØ‡Ææ‡Æï ‡Æï‡Ææ‡Æ∞‡Øç‡Æü‡Øà‡Æ™‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.",
      feat3Title: "‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï ‡ÆÆ‡Øá‡Æ≤‡Ææ‡Æ£‡Øç‡ÆÆ‡Øà",
      feat3Text: "‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡Øç ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æè‡Æ±‡Øç‡Æ±‡Ææ‡ÆÆ‡Æ≤‡Øç ‡Æ®‡Æø‡Æ∞‡Øç‡Æµ‡Ææ‡Æï‡Æ™‡Øç‡Æ™‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æâ‡Æ£‡Æµ‡ØÅ‡Æï‡Æ≥‡Øà‡Æö‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç."
    }
  };

  function changeLanguage(lang) {
    const t = translations[lang] || translations.en;
    document.getElementById('header-tagline').childNodes[0].textContent = t.headerTagline + " ";
    document.getElementById('home-pill-text').textContent = t.homePill;
    document.getElementById('home-welcome').childNodes[0].textContent = t.homeWelcome + " ";
    document.getElementById('home-desc').textContent = t.homeDesc;
    document.getElementById('home-start-btn').textContent = t.start;
    document.getElementById('home-explore-btn').textContent = t.explore;
    document.getElementById('home-why-title').textContent = t.keyFeatures;
    document.getElementById('home-shortcuts-title').textContent = t.shortcuts;
    document.getElementById('home-shortcuts-note').textContent = t.shortcutsNote;
    document.getElementById('feat1-title').textContent = t.feat1Title;
    document.getElementById('feat1-text').textContent = t.feat1Text;
    document.getElementById('feat2-title').textContent = t.feat2Title;
    document.getElementById('feat2-text').textContent = t.feat2Text;
    document.getElementById('feat3-title').textContent = t.feat3Title;
    document.getElementById('feat3-text').textContent = t.feat3Text;
  }

  // --------- INITIAL RENDER ---------

loadMenuFromServer();
updateCart();
updateLoyaltyUI();
renderCalories();
renderMostOrdered();


</script>

</body>
</html>
